{% extends 'core/base.html' %}

{% block title %}Transaction History - Ken{% endblock %}

{% block content %}
<div class="pb-20 md:pb-6">
    
    <div class="mb-10">
        <h1 class="text-3xl font-bold text-white font-slab mb-3">Transaction History</h1>
        <p class="text-gray-400 text-lg">View all your earnings and withdrawals</p>
    </div>
    
    <div x-data="{ tab: 'all' }" class="mb-8">
        <div class="flex items-center space-x-3 mb-8 overflow-x-auto pb-2">
            <button @click="tab = 'all'" :class="tab === 'all' ? 'bg-primary text-black' : 'bg-gray-800 text-gray-300 hover:bg-gray-700'" class="px-6 py-3 rounded-xl font-bold transition whitespace-nowrap">
                All
            </button>
            <button @click="tab = 'earnings'" :class="tab === 'earnings' ? 'bg-primary text-black' : 'bg-gray-800 text-gray-300 hover:bg-gray-700'" class="px-6 py-3 rounded-xl font-bold transition whitespace-nowrap">
                <svg class="w-5 h-5 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
                Earnings
            </button>
            <button @click="tab = 'withdrawals'" :class="tab === 'withdrawals' ? 'bg-primary text-black' : 'bg-gray-800 text-gray-300 hover:bg-gray-700'" class="px-6 py-3 rounded-xl font-bold transition whitespace-nowrap">
                <svg class="w-5 h-5 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"/>
                </svg>
                Withdrawals
            </button>
            <button @click="tab = 'tasks'" :class="tab === 'tasks' ? 'bg-primary text-black' : 'bg-gray-800 text-gray-300 hover:bg-gray-700'" class="px-6 py-3 rounded-xl font-bold transition whitespace-nowrap">
                <svg class="w-5 h-5 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
                Tasks
            </button>
        </div>
        
        <div x-show="tab === 'all' || tab === 'earnings'">
            <h2 class="text-2xl font-bold text-white mb-6 font-slab">
                <svg class="w-6 h-6 inline mr-2 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
                Earnings
            </h2>
            
            {% if transactions %}
            <div class="space-y-4 mb-12">
                {% for transaction in transactions %}
                {% if transaction.transaction_type == 'earning' or transaction.transaction_type == 'bonus' %}
                <div class="card p-6 rounded-xl">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-5">
                            <div class="w-14 h-14 bg-green-900/30 rounded-full flex items-center justify-center">
                                <svg class="w-6 h-6 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                </svg>
                            </div>
                            <div>
                                <p class="text-white font-bold text-lg mb-1">{{ transaction.get_transaction_type_display }}</p>
                                <p class="text-gray-400 text-sm">{{ transaction.created_at|date:"M d, Y - H:i" }}</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <p class="text-green-400 font-bold text-2xl mb-1">+{{ transaction.amount_cfa }} CFA</p>
                            <p class="text-gray-500 text-sm">+{{ transaction.points }} pts</p>
                        </div>
                    </div>
                </div>
                {% endif %}
                {% endfor %}
            </div>
            {% else %}
            <div class="card p-8 rounded-xl text-center">
                <svg class="w-16 h-16 text-gray-600 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
                <h3 class="text-xl font-bold text-white mb-2 font-slab">No Earnings Yet</h3>
                <p class="text-gray-400 mb-4">Start completing tasks to see your earnings here</p>
                <a href="{% url 'task_list' %}" class="btn-primary inline-block px-6 py-3 rounded-xl font-bold text-black">
                    Browse Tasks
                </a>
            </div>
            {% endif %}
        </div>
        
        <div x-show="tab === 'all' || tab === 'withdrawals'">
            <h2 class="text-2xl font-bold text-white mb-6 font-slab">
                <svg class="w-6 h-6 inline mr-2 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"/>
                </svg>
                Withdrawals
            </h2>
            
            {% if transactions %}
            <div class="space-y-4 mb-12">
                {% for transaction in transactions %}
                {% if transaction.transaction_type == 'withdrawal' %}
                <div class="card p-6 rounded-xl">
                    <div class="flex items-center justify-between mb-4">
                        <div class="flex items-center space-x-5">
                            <div class="w-14 h-14 bg-blue-900/30 rounded-full flex items-center justify-center">
                                <svg class="w-6 h-6 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"/>
                                </svg>
                            </div>
                            <div>
                                <p class="text-white font-bold text-lg mb-1">Withdrawal Request</p>
                                <p class="text-gray-400 text-sm">{{ transaction.created_at|date:"M d, Y - H:i" }}</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <p class="text-blue-400 font-bold text-2xl mb-2">-{{ transaction.amount_cfa }} CFA</p>
                            {% if transaction.status == 'pending' %}
                            <span class="px-2 py-1 bg-yellow-900/30 text-yellow-400 rounded-full text-xs font-bold">Pending</span>
                            {% elif transaction.status == 'approved' %}
                            <span class="px-2 py-1 bg-green-900/30 text-green-400 rounded-full text-xs font-bold">Approved</span>
                            {% elif transaction.status == 'rejected' %}
                            <span class="px-2 py-1 bg-red-900/30 text-red-400 rounded-full text-xs font-bold">Rejected</span>
                            {% elif transaction.status == 'completed' %}
                            <span class="px-2 py-1 bg-primary/20 text-primary rounded-full text-xs font-bold">Completed</span>
                            {% endif %}
                        </div>
                    </div>
                    {% if transaction.phone_number %}
                    <div class="text-gray-500 text-sm pt-4 mt-4 border-t border-gray-700">
                        <p>
                            <svg class="w-4 h-4 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
                            </svg>
                            {{ transaction.mobile_money_provider }} - {{ transaction.phone_number }}
                        </p>
                    </div>
                    {% endif %}
                </div>
                {% endif %}
                {% endfor %}
            </div>
            {% else %}
            <div class="card p-8 rounded-xl text-center">
                <svg class="w-16 h-16 text-gray-600 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"/>
                </svg>
                <h3 class="text-xl font-bold text-white mb-2 font-slab">No Withdrawals Yet</h3>
                <p class="text-gray-400 mb-4">You haven't made any withdrawal requests</p>
                <a href="{% url 'withdrawal' %}" class="btn-primary inline-block px-6 py-3 rounded-xl font-bold text-black">
                    Request Withdrawal
                </a>
            </div>
            {% endif %}
        </div>
        
        <div x-show="tab === 'all' || tab === 'tasks'">
            <h2 class="text-2xl font-bold text-white mb-6 font-slab">
                <svg class="w-6 h-6 inline mr-2 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
                Task Completions
            </h2>
            
            {% if task_history %}
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                {% for completion in task_history %}
                <div class="card p-6 rounded-xl">
                    <div class="flex items-start justify-between mb-4">
                        <div class="flex items-start space-x-4 flex-1">
                            <div class="w-12 h-12 {% if completion.is_verified %}bg-primary/20{% else %}bg-yellow-900/30{% endif %} rounded-full flex items-center justify-center flex-shrink-0">
                                {% if completion.is_verified %}
                                <svg class="w-5 h-5 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                </svg>
                                {% else %}
                                <svg class="w-5 h-5 text-yellow-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                </svg>
                                {% endif %}
                            </div>
                            <div class="flex-1">
                                <p class="text-white font-bold text-base mb-2">{{ completion.task.title }}</p>
                                <p class="text-gray-500 text-sm">{{ completion.completed_at|date:"M d, Y - H:i" }}</p>
                                {% if not completion.is_verified %}
                                <span class="inline-block mt-3 px-3 py-1 bg-yellow-900/30 text-yellow-400 rounded-full text-xs font-bold">
                                    Pending Verification
                                </span>
                                {% endif %}
                            </div>
                        </div>
                        <div class="text-right">
                            <p class="text-primary font-bold text-xl mb-1">+{{ completion.points_earned }}</p>
                            <p class="text-gray-400 text-sm">{{ completion.cfa_earned }} CFA</p>
                        </div>
                    </div>
                    
                    {% if completion.proof_screenshot %}
                    <div class="pt-4 mt-4 border-t border-gray-700">
                        <a href="{{ completion.proof_screenshot.url }}" target="_blank" class="text-primary text-sm hover:underline flex items-center">
                            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                            </svg>
                            View Proof Screenshot
                        </a>
                    </div>
                    {% endif %}
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="card p-8 rounded-xl text-center">
                <svg class="w-16 h-16 text-gray-600 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"/>
                </svg>
                <h3 class="text-xl font-bold text-white mb-2 font-slab">No Tasks Completed</h3>
                <p class="text-gray-400 mb-4">Complete tasks to start earning</p>
                <a href="{% url 'task_list' %}" class="btn-primary inline-block px-6 py-3 rounded-xl font-bold text-black">
                    View Available Tasks
                </a>
            </div>
            {% endif %}
        </div>
    </div>
    
</div>
{% endblock %}
